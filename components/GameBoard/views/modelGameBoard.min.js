$(document).ready(function(){modelGameBoard=function(a){this.Init(a)};modelGameBoard.prototype.GameStart=function(a,b,c){var d=this;$.post(this.URL.Base+this.URL.GameStart,{LobbyID:a},function(e){e.Error?e.Error==d.ErrorTypes.DataError?d.GameStart(a,b,c):console.log(d.URL.Base+d.URL.GameStart+" : Error = "+e.Error):(d.GameSet(e),"function"===typeof c&&c())},"json")};modelGameBoard.prototype.GameGet=function(a,b){var c=this;$.post(this.URL.Base+this.URL.GameGet,{LobbyID:a},function(d){d.Error?d.Error==
c.ErrorTypes.ExpireError||d.Error==c.ErrorTypes.DataError?c.GameGet(a,b):console.log(c.URL.Base+c.URL.GameGet+" : Error = "+d.Error):(c.GameSet(d),"function"===typeof b&&b())},"json")};modelGameBoard.prototype.GameFinish=function(a){var b=this.WinnerGet();b||this.GameReset();var c=this;$.post(this.URL.Base+this.URL.GameFinish,{GameID:this.GameID,WinnerID:b.ID},function(b){c.GameReset();"function"===typeof a&&a()},"text")};modelGameBoard.prototype.MoveSet=function(a,b){if(!this.GameID||this.NextMove!=
this.PlayerID||!this.isMoveCorrect(a))return!1;var c=this.AdjacentCellsAccession(this.PlayerID,a);this.MoveAdd(this.PlayerID,a,c);this.MoveTurn();this.serverMoveSet(a,c,b);return!0};modelGameBoard.prototype.serverMoveSet=function(a,b,c){var d=this;$.post(this.URL.Base+this.URL.MoveSet,{GameID:this.GameID,PlayerID:this.PlayerID,ColorIndex:a,CellNumber:b},function(e){e.Error?d.serverMoveSet(a,b,c):"function"===typeof c&&c()},"json")};modelGameBoard.prototype.MoveGet=function(a,b){if(!this.GameID||this.NextMove==
this.PlayerID)return!1;var c=this;$.post(this.URL.Base+this.URL.MoveGet,{GameID:this.GameID,CompetitorID:a},function(d){if(d.Error)d.Error==c.ErrorTypes.ExpireError||d.Error==c.ErrorTypes.DataError?c.MoveGet(a,b):console.log(c.URL.Base+c.URL.MoveGet+" : Error = "+d.Error);else{var e=c.AdjacentCellsAccession(a,d.ColorIndex);c.MoveAdd(a,d.ColorIndex,e);c.MoveTurn();"function"===typeof b&&b()}},"json");return!0};modelGameBoard.prototype.MoveTurn=function(){if(!this.GameID)return!1;for(var a=0;this.PlayersList.Player[a].ID!=
this.NextMove;)a++;this.NextMove=a+1!=this.PlayersList.Player.length?this.PlayersList.Player[a+1].ID:this.PlayersList.Player[0].ID;return!0};modelGameBoard.prototype.Init=function(a){"undefined"!==typeof a.PlayerID&&null!==a.PlayerID&&(this.PlayerID=parseInt(a.PlayerID,10));"undefined"!==typeof a.URL&&null!==a.URL&&(this.URL=a.URL);"undefined"!==typeof a.Size&&null!==a.Size&&(this.Size=a.Size);"undefined"!==typeof a.ErrorTypes&&null!==a.ErrorTypes&&(this.ErrorTypes=a.ErrorTypes);this.GameReset();
return!0};modelGameBoard.prototype.GameSet=function(a){this.LobbyID=parseInt(a.LobbyID,10);this.GameID=parseInt(a.GameID,10);this.Size.X=parseInt(a.SizeX,10);this.Size.Y=parseInt(a.SizeY,10);this.ColorsNumber=parseInt(a.ColorsNumber,10);this.ColorMatrix=a.ColorMatrix;this.PlayersList.Player=a.PlayersList;this.PlayersList.Position=a.PlayersPosition;this.GameTimer=parseInt(a.GameTimer,10);this.MoveTimer=parseInt(a.MoveTimer,10);this.PlayingField=[];for(var b=this.Size.X*this.Size.Y;b--;)this.PlayingField.push(0);
this.NextMove=a.FirstMove;var c=this;$.each(this.PlayersList.Position,function(a,b){c.PlayingField[b-1]=parseInt(c.PlayersList.Player[a].ID);c.PlayingField[b-1]==c.PlayerID&&(c.HomeCellIndex=parseInt(b,10))})};modelGameBoard.prototype.GameReset=function(){this.PlayingField=[];this.HomeCellIndex=null;this.ColorMatrix=[];this.Winner=this.NextMove=this.FinishDate=this.StartDate=this.GameID=this.LobbyID=null;this.PlayersList={Player:[],Position:[]};this.MoveList=[];this.Error={Code:null,Name:null}};modelGameBoard.prototype.MoveAdd=
function(a,b,c){this.MoveList.push({PlayerID:a,ColorIndex:b,CellNumber:c})};modelGameBoard.prototype.LastMoveGet=function(a){var b=this.MoveList.length;if("undefined"!==typeof a)for(;b&&this.MoveList[b-1].PlayerID!=a;)b--;return b?this.MoveList[b-1]:null};modelGameBoard.prototype.GameStatusGet=function(){return this.GameEarlyResultGet()||this.GamePointsResultGet()?!1:!0};modelGameBoard.prototype.WinnerGet=function(){return this.Winner};modelGameBoard.prototype.GameLoad=function(a){this.GameSet(a);
this.MovesLoad(a.MovesList)};modelGameBoard.prototype.MovesLoad=function(a){if(null==a)return!1;var b=this;$.each(a,function(a,d){b.AdjacentCellsAccession(d.PlayerID,d.ColorIndex);b.MoveAdd(d.PlayerID,d.ColorIndex,d.CellNumber);b.MoveTurn()});return!0};modelGameBoard.prototype.PlayersStartingPositionSet=function(a){this.PlayersList.Position=[];this.PlayersList.Position.push(1);if(2==a)this.PlayersList.Position.push(this.Size.X*this.Size.Y);else if(4==a)this.PlayersList.Position.push(this.Size.X),
this.PlayersList.Position.push(this.Size.X*this.Size.Y-this.Size.X+1),this.PlayersList.Position.push(this.Size.X*this.Size.Y);else return!1;return!0};modelGameBoard.prototype.PointsGet=function(a,b){"undefined"!==typeof b&&Array.isArray(b)||(b=this.PlayingField);var c=0;b.forEach(function(b,e){b==a&&c++});return c};modelGameBoard.prototype.PortionGet=function(a){return Math.round(this.PointsGet(a)/(this.Size.X*this.Size.Y)*100)};modelGameBoard.prototype.PlayerGameScoreGet=function(){var a=this.PlayersList.Player,
b=this;a.forEach(function(a,d){a.Points=b.PointsGet(a.ID);a.Portion=b.PortionGet(a.ID);a.ColorIndex=b.PlayerColorIndexGet(a.ID);a.LastMove=b.LastMoveGet(a.ID)});return a};modelGameBoard.prototype.PlayerColorIndexGet=function(a){var b=null,c=this;$.each(this.PlayersList.Position,function(d,e){c.PlayingField[e-1]==a&&(b=parseInt(c.ColorMatrix[e-1],10))});return b};modelGameBoard.prototype.NextMovePlayerGet=function(){return this.NextMove};modelGameBoard.prototype.isMoveCorrect=function(a){for(var b=
0;b<this.PlayingField.length;b++)if(this.PlayingField[b]&&this.ColorMatrix[b]==a)return!1;return!0};modelGameBoard.prototype.CorrectMoveGet=function(){var a,b=this.DisabledColorsGet();do a=this.RandomInteger(1,this.ColorsNumber);while(-1!=b.indexOf(a));return a};modelGameBoard.prototype.DisabledColorsGet=function(){var a=[],b=this;$.each(this.PlayersList.Position,function(c,d){a.push(parseInt(b.ColorMatrix[d-1],10))});return a};modelGameBoard.prototype.ProgressByColorsListGet=function(){for(var a=
[],b=1;b<=this.ColorsNumber;b++)a.push(this.AdjacentCellsNumberGet(this.PlayerID,b));return a};modelGameBoard.prototype.AdjacentCellsListGet=function(a,b){for(var c=this.PlayingField.slice(),d=!0,e=[];d;)for(var d=!1,f=0;f<c.length;f++)this.FreeCellCheck(f+1,b,a,c)&&(e.push(f+1),c[f]=parseInt(a,10),d=!0);return e};modelGameBoard.prototype.AdjacentCellsNumberGet=function(a,b){return this.AdjacentCellsListGet(a,b).length};modelGameBoard.prototype.AdjacentCellsAccession=function(a,b){var c=this.AdjacentCellsListGet(a,
b),d=this;$.each(c,function(b,c){d.PlayingField[c-1]=parseInt(a,10)});c.length&&this.PlayerFieldReindex(a,b);return c.length};modelGameBoard.prototype.PlayerFieldReindex=function(a,b){for(var c=0;c<this.PlayingField.length;c++)this.PlayingField[c]==a&&(this.ColorMatrix[c]=b)};modelGameBoard.prototype.FreeCellCheck=function(a,b,c,d){var e=!1;d[a-1]||this.ColorMatrix[a-1]!=b||(a=this.AdjacentCellIndexGet(a),$.each(a,function(a,b){d[b-1]==c&&(e=!0)}));return e};modelGameBoard.prototype.AdjacentCellIndexGet=
function(a,b){var c=[];"undefined"!==typeof b&&"left"!=b||(a-1)/this.Size.X==Math.floor((a-1)/this.Size.X)||c.push(a-1);"undefined"!==typeof b&&"right"!=b||a/this.Size.X==Math.floor(a/this.Size.X)||c.push(a+1);("undefined"===typeof b||"top"==b)&&0<a-this.Size.X&&c.push(a-this.Size.X);("undefined"===typeof b||"bottom"==b)&&a+this.Size.X<=this.Size.X*this.Size.Y&&c.push(a+this.Size.X);return c};modelGameBoard.prototype.AdjacentCellOwnerGet=function(a,b){var c=[],d=this.AdjacentCellIndexGet(a);$.each(d,
function(a,d){b[d-1]&&-1==c.indexOf(parseInt(b[d-1],10))&&c.push(parseInt(b[d-1],10))});return c};modelGameBoard.prototype.AdjacentCellsOwnersNumberGet=function(a,b){return this.AdjacentCellOwnerGet(a,b).length};modelGameBoard.prototype.GameEarlyResultGet=function(){var a=this.PlayingField.slice(),b,c=0,d=0,e=this;$.each(a,function(c,d){a[c]||1!=e.AdjacentCellsOwnersNumberGet(c+1,a)||(b=e.AdjacentCellOwnerGet(c+1,a),a[c]=b[0])});return-1==a.indexOf(0)?(this.PlayersList.Player.forEach(function(b,h){c=
e.PointsGet(b.ID,a);c>d&&(d=c,e.Winner=b)}),e.Winner.ID):null};modelGameBoard.prototype.GamePointsResultGet=function(){var a=[],b=0,c=0,d=null,e=this.PointsGet(0),f=this;this.PlayersList.Player.forEach(function(e,g){a.push(f.PointsGet(e.ID));a[a.length-1]>b&&(b=a[a.length-1],d=e.ID,c=g,f.Winner=e)});a.splice(c,1);a.forEach(function(a,c){b<a+e&&(d=null,f.Winner=null)});return d};modelGameBoard.prototype.RandomInteger=function(a,b){return Math.floor(Math.random()*(b-a+1))+a}});
